<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./vampireoption.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>

    <script type="text/javascript">
      // array of json objects
      var classmate_data = [
        {
          name: "John",
          shadow: "no",
          garlic: "no",
          pale: "pale",
          isAVampire: "not yet determined",
        },
        {
          name: "Lee",
          shadow: "yes",
          garlic: "no",
          pale: "pale",
          isAVampire: "not yet determined",
        },
        {
          name: "Emma",
          shadow: "no",
          garlic: "yes",
          pale: "brown",
          isAVampire: "not yet determined",
        },
        {
          name: "Ava",
          shadow: "yes",
          garlic: "yes",
          pale: "olive ",
          isAVampire: "not yet determined",
        },
        {
          name: "Alex",
          shadow: "no",
          garlic: "no",
          pale: "brown",
          isAVampire: "not yet determined",
        },
      ];

      window.onload = function () {
        var vampireInputsArray = JSON.parse(
          localStorage.getItem("vampireInputsArray")
        );

        var tableBody = document.getElementById("userTableBody");

        // Clearing existing table rows
        tableBody.innerHTML = "";

        classmate_data.forEach(function (user) {
          var row = document.createElement("tr");

          var nameCell = document.createElement("td");
          nameCell.textContent = user.name;
          row.appendChild(nameCell);

          var shadowCell = document.createElement("td");
          shadowCell.textContent = user.shadow;
          row.appendChild(shadowCell);

          var garlicCell = document.createElement("td");
          garlicCell.textContent = user.garlic;
          row.appendChild(garlicCell);

          var paleCell = document.createElement("td");
          paleCell.textContent = user.pale;
          row.appendChild(paleCell);

          var vampireCell = document.createElement("td");
          vampireCell.textContent = user.isAVampire;
          row.appendChild(vampireCell);

          tableBody.appendChild(row);
        });

        vampireInputsArray.forEach(function (user) {
          var row = document.createElement("tr");

          var nameCell = document.createElement("td");
          nameCell.textContent = user.name;
          row.appendChild(nameCell);

          var shadowCell = document.createElement("td");
          shadowCell.textContent = user.shadow;
          row.appendChild(shadowCell);

          var garlicCell = document.createElement("td");
          garlicCell.textContent = user.garlic;
          row.appendChild(garlicCell);

          var paleCell = document.createElement("td");
          paleCell.textContent = user.pale;
          row.appendChild(paleCell);

          var vampireCell = document.createElement("td");
          vampireCell.textContent = "not yet determined";
          row.appendChild(vampireCell);

          tableBody.appendChild(row);
        });

        localStorage.setItem(
          "vampireInputsArray",
          JSON.stringify(vampireInputsArray)
        );

        var tableBody = document.getElementById("userTableBody");
      };
    </script>

    <script type="text/javascript">
      function display_chosen_option(selectedValue) {
        var classmatesDiv = document.getElementById("classmatesDiv");
        classmatesDiv.style.display = "block";
        switch (selectedValue) {
          case "1":
            var vampireInputsArray = JSON.parse(
              localStorage.getItem("vampireInputsArray")
            );

            var classmate_data = [
              {
                name: "John",
                shadow: "no",
                garlic: "no",
                pale: "pale",
                isAVampire: "not yet determined",
              },
              {
                name: "Lee",
                shadow: "yes",
                garlic: "no",
                pale: "pale",
                isAVampire: "not yet determined",
              },
              {
                name: "Emma",
                shadow: "no",
                garlic: "yes",
                pale: "brown",
                isAVampire: "not yet determined",
              },
              {
                name: "Ava",
                shadow: "yes",
                garlic: "yes",
                pale: "olive ",
                isAVampire: "not yet determined",
              },
              {
                name: "Alex",
                shadow: "no",
                garlic: "no",
                pale: "brown",
                isAVampire: "not yet determined",
              },
            ];

            var newClassmateData = classmate_data.concat(vampireInputsArray);

            var tableBody = document.getElementById("userTableBody");

            // Clear existing table rows
            tableBody.innerHTML = "";

            newClassmateData.forEach(function (user) {
              var row = document.createElement("tr");

              var nameCell = document.createElement("td");
              nameCell.textContent = user.name;
              row.appendChild(nameCell);

              var shadowCell = document.createElement("td");
              shadowCell.textContent = user.shadow;
              row.appendChild(shadowCell);

              var garlicCell = document.createElement("td");
              garlicCell.textContent = user.garlic;
              row.appendChild(garlicCell);

              var paleCell = document.createElement("td");
              paleCell.textContent = user.pale;
              row.appendChild(paleCell);

              // Random calculating if a classmate is a vampire or not
              var isVampire = Math.random() < 0.5;
              user.isAVampire = isVampire;

              var vampireCell = document.createElement("td");
              vampireCell.textContent = user.isAVampire;
              row.appendChild(vampireCell);

              tableBody.appendChild(row);

              // Set the updated vampireInputsArray in local storage
              localStorage.setItem(
                "vampireInputsArray",
                JSON.stringify(vampireInputsArray)
              );

              localStorage.setItem(
                "classmateData",
                JSON.stringify(classmate_data)
              );

              var methodData = {
                method: "Random Guess",
              };

              var jsonData = JSON.stringify(methodData);

              localStorage.setItem("method", jsonData);
            });

            break;
          case "2":
            var vampireInputsArray = JSON.parse(
              localStorage.getItem("vampireInputsArray")
            );

            var classmate_data = [
              {
                name: "John",
                shadow: "no",
                garlic: "no",
                pale: "pale",
                isAVampire: "not yet determined",
              },
              {
                name: "Lee",
                shadow: "yes",
                garlic: "no",
                pale: "pale",
                isAVampire: "not yet determined",
              },
              {
                name: "Emma",
                shadow: "no",
                garlic: "yes",
                pale: "brown",
                isAVampire: "not yet determined",
              },
              {
                name: "Ava",
                shadow: "yes",
                garlic: "yes",
                pale: "olive",
                isAVampire: "not yet determined",
              },
              {
                name: "Alex",
                shadow: "no",
                garlic: "no",
                pale: "brown",
                isAVampire: "not yet determined",
              },
            ];

            var newClassmateData = classmate_data.concat(vampireInputsArray);

            var tableBody = document.getElementById("userTableBody");

            // Clear existing table rows
            tableBody.innerHTML = "";

            newClassmateData.forEach(function (user) {
              var row = document.createElement("tr");
              var count = 0;

              if (user.shadow === "no") {
                count += 4;
              }
              if (user.garlic === "no") {
                count += 3;
              }
              if (user.pale === "pale") {
                count += 3;
              }

              if (count <= 6) {
                user.isAVampire = "false";
              } else if (count > 6) {
                user.isAVampire = "true";
              }

              var nameCell = document.createElement("td");
              nameCell.textContent = user.name;
              row.appendChild(nameCell);

              var shadowCell = document.createElement("td");
              shadowCell.textContent = user.shadow;
              row.appendChild(shadowCell);

              var garlicCell = document.createElement("td");
              garlicCell.textContent = user.garlic;
              row.appendChild(garlicCell);

              var paleCell = document.createElement("td");
              paleCell.textContent = user.pale;
              row.appendChild(paleCell);

              var vampireCell = document.createElement("td");
              vampireCell.textContent = user.isAVampire;
              row.appendChild(vampireCell);

              tableBody.appendChild(row);

              // Set the updated vampireInputsArray in local storage
              localStorage.setItem(
                "vampireInputsArray",
                JSON.stringify(vampireInputsArray)
              );

              // Set the updated classmate data in local storage
              localStorage.setItem(
                "classmateData",
                JSON.stringify(classmate_data)
              );

              var thresholdMethod = {
                method: "Threshold Based",
              };

              var thresholdJsonData = JSON.stringify(thresholdMethod);

              localStorage.setItem("method", thresholdJsonData);
            });

            break;

          default:
            alert(
              "Invalid option selected! Please select an option to get your results!"
            );
            break;
        }
      }

      function clearResult() {
        $("#result").text("");
        $("#resultExplanation").text("");
      }

      function viewClassmates() {
        window.location.href = "classmate.html";
      }
    </script>
  </head>
  <body>
    <div class="container">
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Shadow</th>
            <th>Garlic</th>
            <th>Complexion?</th>
            <th>Is A Vampire?</th>
          </tr>
        </thead>

        <h1>Here is a table of all of your classmates:</h1>
        <tbody id="userTableBody">
          <!-- User data is dynamically added here! -->
        </tbody>
      </table>

      <h2>How would you like to tell if your classmates are vampires?</h2>
      <p>
        Click on one of the "controller" methods below to figure out if your
        classmates are a vampire or not!
      </p>

      <div class="form-group">
        <label for="mySelect">Select Model Logic:</label>
        <select class="form-control" id="mySelect">
          <option value="1">Random Guess</option>
          <option value="2">Threshold Based Method</option>
        </select>

        <button
          type="button"
          onclick="display_chosen_option(document.getElementById('mySelect').value)"
        >
          Display index
        </button>

        <button
          type="button"
          onclick="document.getElementById('mySelect').selectedIndex = '-1'; clearResult();"
        >
          Deselect all options.
        </button>
      </div>

      <!--Div that will hold the pie chart-->
      <div id="chart_div"></div>

      <div class="view-classmates" id="classmatesDiv">
        <p>
          To view the "pie chart" visualization of your classmates being a
          vampire or not click on this button ("View Classmates") below!
        </p>
        <button type="button" onclick="viewClassmates()">
          View Classmates
        </button>
      </div>

      <p>
        Want to insert another classmate? Click on this button ("Go Back One
        Page") below!
      </p>

      <button onclick="window.location.href='vampireinput.html'">
        Go Back One Page
      </button>
    </div>
  </body>
</html>
